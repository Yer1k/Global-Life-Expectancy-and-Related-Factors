---
title: "Project Submission #1"
author: "Pooja Kabber, Dingkun Yang, Echo Chen, Andrew Kroening"
output: pdf_document
date: "October 21st, 2022"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
packages <- (c("tidyverse", "stargazer", "ggfortify", "caTools", "car", "corrplot", "gridExtra"))

# Install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Packages loading
invisible(lapply(packages, library, character.only = TRUE))
```

# Data Overview

The dataset used for this research is from the World Health Organization (WHO). The WHO compiles data on thousands of variables for as many countries as feasible and presents them for analysis. This particular dataset contains national-level observations of variables related to life expectancy around the globe for a period spanning the early portion of the 21st century.

#### Overall Characteristics

The complete dataset contains observations beginning in the year 2000 and ending in the year 2015. As a complete dataset, there are 2,938 observations for 22 variables. In practical terms, each country has approximately one observation, averaging 183 for each of the 16 years encompassed by the data. The dataset effectively contains 20 variables for each country and year combination, covering major disease, economic, and social factors. The variables are fully described in **Appendix C, Table XXXXX**. 

#### Sample Dataset Characteristics

In the context of this analysis, the dataset will be reduced to include only the year 2014. This yields once observation for 183 countries across all of the variables.

#### Research Questions:

* How did major disease, economic, and social factors impact life expectancy around the globe in 2014?"

* How did disease and mortality rates, along with national economic factors, contribute to a country's development status in 2014?

# Primary Relationship of Interest

As mentioned, the data for this analysis will be truncated to 2014 and reduced to certain variables based on their potential relevance to the research questions. When building a model, it is not wise use all variables when they are highly correlated with each other. To represent immunization coverage, among "Hepatitis.B","Polio", "Diphtheria tetanus toxoid and pertussis (DTP3)", we opted to use "polio", since it has the highest correlation with Life Expectancy. Similarly, we see extremely high correlation between GDP and percentage expenditure. However, since both of them could have meaningful interpretations and the categories are distinct, we may want to decide which one goes to our final model when we conduct model selection.

For fairly obvious reasons, we know the "Adult.Mortality", "infant.deaths" and "under.five.deaths" variables are directly correlated to Life Expectancy, we choose to drop them from the predictor variable list; on the other hand, we are interested in the "HIV.AIDS" variable (Deaths per 1,000 live births HIV/AIDS (0-4 years). The rationale for this decision is that the mortality and death variables are measuring the fatalities of entire groups of the population, whereas the "HIV.AIDS" variable is a single measurement that might encompass several underlying societal indicators.

We will omit the variables that have low correlation with Life Expectancy: "Measles"; however, we do want to include "population" because of our interest. As for categorical variable, we would like to keep country status (developing/developed) as one of the predictors. In doing so, the dataset is reduced in  size to 183 observations of the following variables:
 
 > 'Country', 'Status', 'Population', 'Life.expectancy', 'percentage.expenditure', 'Hepatitis.B', 'Measles', 'Polio', ' HIV.AIDS', 'Diphtheria', 'GDP', 'Schooling', 'Income.composition.of.resources'
 
The research team estimates that these variables will lead to the best model fit for the dual-purpose nature of this analysis. Table 1 describes summary information about each of the variables that the team believes have a potential to be included in a final model.

```{r Initial EDA and Table 1, echo=FALSE, results="asis", header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
life <- read.csv(file = '/Users/andrewkroening/Desktop/orange-modeling-project/_00_Datasets/Life_Expectancy_Data.csv')
le14 <- life[which(life$Year==2014),] # select year 2014
le14$Status <-factor(le14$Status)
le14_subset <- subset(le14,select = -c(Country,Year,Adult.Mortality,infant.deaths,Alcohol,BMI,under.five.deaths,Total.expenditure,thinness..1.19.years,thinness.5.9.years))# select variables
stargazer(le14_subset,type = "latex", no.space = TRUE,
          report = ('vcsp*'), single.row = TRUE, header = FALSE,
          column.sep.width = "0.2pt",
          font.size = "small",
          title="Summary of Variables")
```

# Other Characteristics

Some important variables are called out below:

* Life.expectancy: Continuous variable of the adult mortality rates of both sexes (probability of dying between 15 and 60 years per 1000 population).

* Status: Categorical variable identifies a country as 'Developing' or 'Developed' in the given year.

* GDP: Continuous variable showing Gross Domestic Product per capita in the given year.

* Population: Continuous variable with the total estimated population for the country in a given year.

* percentage.expenditure: Expenditure on health as a percentage of Gross Domestic Product per capita (%).

* Hepatitis.B: Hepatitis B (HepB) immunization coverage among 1-year-olds (%).

* Measles: Continuous variable of the number of reported cases per 1000 population.

* Polio: Polio immunization coverage among 1-year-olds (%).

* HIV.AIDS: Continuous variable of the deaths per 1,000 live births due to HIV/AIDS for 0-4 year olds.

* Diphtheria: Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%).

* Schooling: Continuous variable expressing the average number of years of school completed among the country's population.

* Income.composition.of.resources: Human Development Index in terms of income composition of resources (index ranging from 0 to 1).


# Potential Challenges

#### Missingness

The primary challenge facing the project is missing data. In the 2014 subset of the Life Expectancy dataset, there are 51 observations with a missing value in at least one of the potential predictors:

* 41x 'Population' observations 

* 10x 'Hep.B' observations

* 28x 'GDP' observations

* 10x 'Schooling' observations

* 10x 'Income.composition.of.resources' observations

The team has proposed three potential avenues for mitigating the effects of these missing values. The observations in question may be dropped or filled with a mean or median value for that variable based on the observed skew.

#### Skew

There is a second challenge posed in some of the variables in the dataset by a skewed distribution. When checking box plots of all variables, we found 4 variables may need transformation before inclusion in the final model.

```{r, fig.width=7, fig.height=5, fig.show='hold', out.width="85%", fig.align='center', results="asis", echo=FALSE, header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
## If interested, Comment out to see whats going on ##
# c <- ggplot(le14, aes(x=Life.expectancy))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Life Expectancy in age")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
# c1 <- ggplot(le14, aes(x=Polio))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Polio (Pol3) immunization coverage among 1-year-olds (%)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
# c2 <- ggplot(le14, aes(x=BMI))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Average Body Mass Index of entire population")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
c3 <- ggplot(le14, aes(x=percentage.expenditure))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "Expenditure on health as a percentage of Gross Domestic Product per capita(%)")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
# c4 <- ggplot(le14, aes(x=Total.expenditure))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "General government expenditure on health as a percentage of total government expenditure (%)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
c5 <- ggplot(le14, aes(x=HIV.AIDS))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "Deaths per 1 000 live births HIV/AIDS (0-4 years)")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
c6 <- ggplot(le14, aes(x=GDP))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "Gross Domestic Product per capita (in USD)")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
c7 <- ggplot(le14, aes(x=Population))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "Population of the country")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
# c8 <- ggplot(le14, aes(x=Income.composition.of.resources))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Human Development Index in terms of income composition of resources (index ranging from 0 to 1)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
# c9 <- ggplot(le14, aes(x=Schooling))+
#   geom_boxplot(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Number of years of Schooling(years)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))

### All Box Plot, if comment out ###
# grid.arrange(c,c1,c2,c3,c4,c5,c6,c7,c8,c9)

grid.arrange(c3,c5,c6,c7)
```

We may want to use log transformation for population and GDP, because of the magnitude of gaps. But for other two, we need more investigation due to the difficulty of interpretation. The box plots and histograms of the population and GDP variables after log transformation yield a better distribution:

```{r, fig.width=7, fig.height=4, fig.show='hold', out.width="85%", fig.align='center', results="asis", echo=FALSE, header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

# c3 <- ggplot(le14, aes(x=percentage.expenditure))+
#   geom_histogram(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Expenditure on health as a percentage of Gross Domestic Product per capita(%)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
# c5 <- ggplot(le14, aes(x=HIV.AIDS))+
#   geom_histogram(color="darkblue", fill="lightblue")+
#   labs(#title="Box Plot of Polio for Children Under 3 Years Old",
#       x = "Deaths per 1 000 live births HIV/AIDS (0-4 years)")+
#   theme(plot.title = element_text(size=10),
#         axis.title = element_text(size=6))
c6 <- ggplot(le14, aes(x=log10(GDP)))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "ln(Gross Domestic Product per capita (in USD))")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
c7 <- ggplot(le14, aes(x=log10(Population)))+
  geom_boxplot(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "ln(Population of the country)")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))

c6_1 <- ggplot(le14, aes(x=log10(GDP)))+
  geom_histogram(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "ln(Gross Domestic Product per capita (in USD))")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))
c7_1 <- ggplot(le14, aes(x=log10(Population)))+
  geom_histogram(color="darkblue", fill="lightblue")+
  labs(#title="Box Plot of Polio for Children Under 3 Years Old",
      x = "ln(Population of the country)")+
  theme(plot.title = element_text(size=10),
        axis.title = element_text(size=6))

grid.arrange(c6,c7,c6_1,c7_1,ncol=2)
```


\newpage
# Appendix A - Regression Models

After selection Model:

```{r, echo=FALSE, results="asis", header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
fit2 <- lm(Life.expectancy ~ BMI+log10(GDP)+percentage.expenditure+Polio+HIV.AIDS+Total.expenditure+log10(Population)+Income.composition.of.resources+Status+Schooling, data=le14)
stargazer(fit2,header=FALSE, type="latex", 
          no.space = TRUE,
          report = ('vcsp*'), single.row = TRUE,
          column.sep.width = "0.2pt",
          font.size = "small",
          title="Regression Summary")
par(mfrow = c(2, 2))
plot(fit2)
```
\newpage
Potential Final Model :

```{r, echo=FALSE, results="asis", header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
fit2 <- lm(Life.expectancy ~ log10(GDP)+HIV.AIDS+Income.composition.of.resources+Status, data=le14)
stargazer(fit2,header=FALSE, type="latex", 
          no.space = TRUE,
          report = ('vcsp*'), single.row = TRUE,
          column.sep.width = "0.2pt",
          font.size = "small",
          title="Regression Summary")
par(mfrow = c(2, 2))
plot(fit2)
```


\newpage
# Appendix B - Supporting Tables and Figures

#### This appendix is for primary supporting information, tables, or plots that are *valuable for the model that we are keeping*.

#### "Figure XX - Correlation Matrix" 
```{r correlation matrix, fig.width=8, fig.height=8, fig.show='hold', out.width="90%", fig.align='center', results="asis", echo=FALSE, header=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
le14_cont <- le14[,c("Life.expectancy", "Adult.Mortality", "infant.deaths","Alcohol","percentage.expenditure", "Hepatitis.B","Measles","BMI","under.five.deaths","Polio","Total.expenditure","Diphtheria" ,"HIV.AIDS","GDP","Population","thinness..1.19.years","thinness.5.9.years","Income.composition.of.resources",
"Schooling")]
le14_cont_clean <- na.omit(le14_cont)
le14_cont_clean.cor <- cor(le14_cont_clean)
par(mfrow = c(1, 1))
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(le14_cont_clean.cor, method="color", col=col(200),  
     diag=FALSE, # tl.pos="d", 
         type="upper", order="hclust", 
     # title=title, 
         addCoef.col = "black", # Add coefficient of correlation
         # Combine with significance
         # p.mat = p.mat, sig.level = 0.05, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
     tl.cex=0.7,
     number.cex=0.7,
     mar=c(0,0,0,0)
         )
```



\newpage
# Appendix C - Variables Description

#### This appendix is for other information, tables, or plots that are less valuable to the models or will be removed.

#### Table XXXX - All Variables
| Variable                        |  Type   |                                                                                            Description |
|-------------------------|:----------------:|-----------------------------:|
| Country                         | factor  |                                                                                           Country name |
| Year                            | numeric |                                                                                       Year of the data |
| Status                          | factor  |                                                              Country status of developed or developing |
| Life_Expectancy                 | numeric |                                                                                 Life expectancy in age |
| Adult_Mortality                 | numeric | Adult Mortality Rates of both sexes (probability of dying between 15 and 60 years per 1000 population) |
| infant.deaths                   | numeric |                                                            Number of Infant Deaths per 1000 population |
| Alcohol                         | numeric |                             Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol) |
| percentage.expenditure          | numeric |                          Expenditure on health as a percentage of Gross Domestic Product per capita(%) |
| Hepatitis.B                     | numeric |                                         Hepatitis B (HepB) immunization coverage among 1-year-olds (%) |
| Measles                         | numeric |                                                           number of reported cases per 1000 population |
| BMI                             | numeric |                                                           Average Body Mass Index of entire population |
| under.five.deaths               | numeric |                                                        Number of under-five deaths per 1000 population |
| Polio                           | numeric |                                               Polio (Pol3) immunization coverage among 1-year-olds (%) |
| Total.expenditure               | numeric |           General government expenditure on health as a percentage of total government expenditure (%) |
| Diphtheria                      | numeric |             Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%) |
| HIV.AIDS                        | numeric |                                                      Deaths per 1 000 live births HIV/AIDS (0-4 years) |
| GDP                             | numeric |                                                             Gross Domestic Product per capita (in USD) |
| Population                      | numeric |                                                                              Population of the country |
| thinness..1.19.years            | numeric |                            Prevalence of thinness among children and adolescents for Age 10 to 19 (% ) |
| thinness.5.9.years              | numeric |                                                Prevalence of thinness among children for Age 5 to 9(%) |
| Income.composition.of.resources | numeric |        Human Development Index in terms of income composition of resources (index ranging from 0 to 1) |
| Schooling                       | numeric |                                                                    Number of years of Schooling(years) |
